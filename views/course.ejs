<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <style>
        table, th, td{
            border: 2px solid black;
        }
    </style>
</head>
<body>
    <a href="/">Student</a>
    <a href="/instructor">Instructor</a>
    <a href="/enrollment">Enrollment</a>
    <a href="/course">Course</a>
    <a href="/grade">Grade</a>
    <a href="/semester">Semester</a>
    <a href="/payment">Payment</a>
    <a href="/notification">Notification</a>
        <form action="" method="post">
            <div>
                <input type="text" name="courseName" placeholder="courseName">
                <input type="text" name="courseCode" placeholder="courseCode">
                <input type="text" name="description" placeholder="description">
                <input type="text" name="instructor" placeholder="instructor">
                <input type="text" name="creditHours" placeholder="creditHours">
                <input type="text" name="maximumEnrollment" placeholder="maximumEnrollment">
                <input type="text" name="semester" placeholder="semester">
            </div>
            <br>
            <button>Submit</button>      
        </form>
    <table>
        
        <% if(details!=null) { %>
        <tr>
            <th>Course Name</th>
            <th>Course Code</th>
            <th>Description</th>
            <th>Instructor</th>
            <th>Credit Hours</th>
            <th>Maximum Enrollment</th>
            <th>Semester/Year Offered</th>
            <th colspan="2">Actions</th>
        </tr>
        <% details.forEach(function(item){ %>
        <tr>
            <td><%= item.courseName %></td>
            <td><%= item.courseCode %></td>
            <td><%= item.description %></td>
            <td><%= item.instructor %></td>
            <td><%= item.creditHours %></td>
            <td><%= item.maximumEnrollment %></td>
            <td><%= item.semester %></td>
            <td>
                <button class="edit-button">Edit</button>
            </td>
            <td><button class="delete-button" data-course-id="<%= item._id %>">Delete</button></td>
        </tr>

        <tr class="edit-form" style="display: none;">
            <td><input type="text" name="courseName" value="<%= item.courseName %>"></td>
            <td><input type="text" name="courseCode" value="<%= item.courseCode %>"></td>
            <td><input type="text" name="description" value="<%= item.description %>"></td>
            <td><input type="text" name="instructor" value="<%= item.instructor %>"></td>
            <td><input type="text" name="creditHours" value="<%= item.creditHours %>"></td>
            <td><input type="text" name="maximumEnrollment" value="<%= item.maximumEnrollment %>"></td>
            <td><input type="text" name="semester" value="<%= item.semester %>"></td>
            <td><button class="update-button" data-course-id="<%= item._id %>">Update</button></td>
        </tr>
        <% })%>
    </table>
    <% }%>

    <script>
        const deleteButtons = document.querySelectorAll(".delete-button");
    
        deleteButtons.forEach(button => {
            button.addEventListener("click", async (event) => {
                event.preventDefault();
                const courseId = button.getAttribute("data-course-id");
                console.log(courseId)
                try {
                    const response = await fetch(`/delete/course/${courseId}`, {
                        method: "DELETE",
                    });
    
                    if (response.ok) {
                        // Reload the page after successful deletion
                        window.location.reload();
                    } else {
                        console.error("Error deleting course");
                    }
                } catch (error) {
                    console.error(error);
                }
            });
        });


        const editButtons = document.querySelectorAll(".edit-button");

        editButtons.forEach(button => {
            button.addEventListener("click", () => {
                const row = button.parentElement.parentElement;
                const editForm = row.nextElementSibling; // Get the next row, which is the edit form
                console.log("clicked edit", editForm)
                row.style.display = "none";
                editForm.style.display = "table-row"; // Show the edit form
            });
        });


        const updateButtons = document.querySelectorAll(".update-button");

        updateButtons.forEach(button => {
            button.addEventListener("click", async () => {
                console.log('update clicked!')
                const editForm = button.parentElement.parentElement;
                const row = editForm.previousElementSibling; // Get the previous row, which is the data row
                const cells = row.querySelectorAll("td"); // Get all cells in the data row

                const courseId = button.getAttribute("data-course-id");

                const requestBody = {
                    courseName: editForm.querySelector('input[name="courseName"]').value,
                    courseCode: editForm.querySelector('input[name="courseCode"]').value,
                    description: editForm.querySelector('input[name="description"]').value,
                    creditHours: editForm.querySelector('input[name="creditHours"]').value,
                    instructor: editForm.querySelector('input[name="instructor"]').value,
                    maximumEnrollment: editForm.querySelector('input[name="maximumEnrollment"]').value,
                    semester: editForm.querySelector('input[name="semester"]').value
                };

                console.log(requestBody)

                try {
                    const response = await fetch(`/update/course/${courseId}`, {
                        method: "PUT",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify(requestBody)
                    });

                    if (response.ok) {
                        console.log("PUT request successful");
                        // Reload the page or perform any necessary actions
                        window.location.reload();
                    } else {
                        console.error("Error in PUT request");
                    }
                } catch (error) {
                    console.error(error);
                }
            });
        });




    </script>
    
</body>
</html>